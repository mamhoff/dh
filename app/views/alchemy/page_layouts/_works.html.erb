<main class="dh-works">

  <%= render_elements %>

  <%
    sorted_pages = Alchemy::Page.joins(:essence_dates).includes(:essence_dates).order('alchemy_essence_dates.date DESC')

    new_pages = sorted_pages.map do |page|
      { id: page.id, date: page.essence_dates[0].date }
    end


    big_structure = Hash.new
    sorted_pages.each do |page|
      date = page.essence_dates[0].date
      year = date.year if date
      key = year ? year.to_s : 'Unknown year'
      unless big_structure.has_key? key
        big_structure[key] = Array.new
      end
    end

    sorted_pages.each do |page|
      date = page.essence_dates[0].date
      year = date.year if date
      key = year ? year.to_s : 'Unknown year'
      big_structure[key].push(page)
    end

    new_structure = HashWithIndifferentAccess.new big_structure
  %>

  <% new_structure.each do |key, value| %>
    <section class="year">
      <h2><%= key %></h2>
      <div class="row">
        <% value.each do |page| %>
          <a href="<%= "/#{page.urlname}" %>">
            <figure class="col-sm-3">
              <img src="">
              <figcaption><%= page.title %></figcaption>
            </figure>
          </a>
        <% end %>
      </div>
    </section>
  <% end %>


  <%# Paginierung!!! %>

</main>
